<app-header></app-header>

<!-- Modal -->
<app-modal #modal [title]="'Select the option of your preference'" [rejectButtonText]="'general.cancel' | translate"
  [acceptButtonText]="'general.accept' | translate" (confirmAction)="onAccept()">
  <div style="text-align:center">
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" id="isPersonalModal" value="isPersonal" [(ngModel)]="isSelectOption"
        (change)="onRadioChange($event)" [disabled]="isPendingApproval">
      <label class="form-check-label" for="isPersonalModal">{{ 'profile.personal' | translate }}</label>
    </div>
    <div class="form-check form-check-inline">
      <input class="form-check-input" type="radio" id="isBusinessModal" value="isBusiness" [(ngModel)]="isSelectOption"
        (change)="onRadioChange($event)" [disabled]="isPendingApproval">
      <label class="form-check-label" for="isBusinessModal">{{ 'profile.business' | translate }}</label>
    </div>
  </div>
</app-modal>
<!-- End Modal -->
<!-- Modal de confirmaciÃ³n -->
<app-modal 
  #confirmationModal 
  [title]="'profile.thanksForJoining' | translate" 
  [rejectButtonText]="'general.close' | translate"
>

  <div class="text-center p-3">
    <p class="fs-5">
      {{ 'profile.thanksForBecomingProfessional' | translate }}
    </p>
  </div>
</app-modal>

<div class="container-fluid" style="margin-top: 5rem;">
  <div class="row">
    <div class="col-lg-3"></div>

    <div class="col-lg-6 p-4 col-12">

      <!-- Show  showOptsPro -->
      <div class="mt-3 text-center" *ngIf="showOptsPro">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="inlineRadioOptions" id="isPersonalFooter"
            value="isPersonal" [(ngModel)]="isSelectOption" (change)="onRadioChange($event)" [disabled]="isDisabled">
          <label class="form-check-label" for="isPersonalFooter">{{ 'profile.personal' | translate }}</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="inlineRadioOptions" id="isBusinessFooter"
            value="isBusiness" [(ngModel)]="isSelectOption" (change)="onRadioChange($event)">
          <label class="form-check-label" for="isBusinessFooter">{{ 'profile.business' | translate }}</label>
        </div>
      </div>


      <div class="card container-box mt-3">
        <h5 class="card-header bg-primary text-light" *ngIf="!isNext">
          {{ 'profile.formPersonal' | translate }}
        </h5>
        <h5 class="card-header bg-primary text-light" *ngIf="isNext">
          {{ 'profile.formBusiness' | translate }}
        </h5>
        <div class="payment-container" *ngIf="paymentInitiated">
          <div *ngIf="isLoading">
            <h2>{{ 'payment.preparingPayment' | translate }}</h2>
            <p>{{ 'payment.redirectingToStripe' | translate }}</p>
            <div class="spinner"></div>
          </div>

          <div *ngIf="!isLoading && errorMessagePayment">
            <h2>{{ 'payment.errorInitiatingPayment' | translate }}</h2>
            <p>{{ errorMessagePayment }}</p>
            <button (click)="retryPayment()" class="btn btn-primary btn-lg btn-block ">{{ 'general.retryPayment' | translate }}</button>
            <button (click)="goToCategorySelection()" class="btn btn-secondary">{{ 'general.backToCategorySelection' |
              translate }}</button>
          </div>

        </div>
      </div>
      <div class="card-body bg-white container-box">
        <app-floating-alert [alertMessage]="alertMessage" [backendMessage]="backendMessage" />
        
        <!-- Mensaje de pending approval -->
        <div *ngIf="isPendingApproval" class="alert alert-warning d-flex align-items-center mb-4" role="alert">
          <i class="bi bi-clock-history me-3" style="font-size: 1.5rem;"></i>
          <div>
            <h5 class="alert-heading mb-1">{{ 'profile.pendingApproval' | translate }}</h5>
            <p class="mb-0">{{ 'profile.pendingApprovalMessage' | translate }}</p>
          </div>
        </div>
        
        <p class="d-flex justify-content-end"><strong>Status:</strong> {{user.profile?.status || ''}}</p>
        <!-- Personal form -->
        <div *ngIf="!isNext">
          <app-pro-personal-form [parentForm]="proPersonalForm" [listCategories]="listCategories"
            [listZipcode]="listZipcode" (licensesChanged)="onLicensesChangedFromChild($event)"
            (fileSelected)="onFileSelectedPersonal($event)" [previewImgPersonal]="previewImgPersonal"
            [imagePersonal]="imagePersonal" [initialLicenses]="initialLicenses" [isPendingApproval]="isPendingApproval">
          </app-pro-personal-form>

          <div class="d-flex justify-content-end mt-3">
            <button *ngIf="isSelectOption === 'isPersonal'" type="button" 
              class="btn btn-primary btn-lg btn-block btn-lg btn-block"
              (click)="onSubmit()" [disabled]="isPendingApproval || isLoading">
              

             
              <small *ngIf="!isLoading" class="sr-only">{{ 'general.save' | translate }}</small>
              <small *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"> </small>
              <small *ngIf="isLoading" class="sr-only">{{ 'general.save' | translate }}</small>
              
            </button>

            <button *ngIf="isSelectOption !== 'isPersonal'" type="button" 
              class="btn btn-primary btn-lg btn-block  btn-lg btn-block"
              (click)="nextStep()" [disabled]="isPendingApproval">
              {{ 'general.next' | translate }}
            </button>
          </div>
        </div>

        <!-- Business form -->
        <div *ngIf="isNext">
          <app-pro-business-form [parentForm]="proBusinessForm" [previewImgBusiness]="previewImgBusiness"
            [imageBusiness]="imageBusiness" (fileSelected)="onFileSelectedBusiness($event)" 
            [isPendingApproval]="isPendingApproval">
          
          </app-pro-business-form>

          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-outline-primary btn-lg btn-block mt-3" 
              (click)="previousStep()" [disabled]="isPendingApproval">
              {{ 'general.previous' | translate }}
            </button>
            <button type="button" class="btn btn-primary   btn-lg btn-block mt-3" 
              (click)="onSubmit()" [disabled]="isPendingApproval || isLoading">
             
              <small *ngIf="!isLoading" class="sr-only">{{ 'general.save' | translate }}</small>
              <small *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"> </small>
              <small *ngIf="isLoading" class="sr-only">{{ 'general.save' | translate }}</small>
            </button>
          </div>
          <div class="payment-container" *ngIf="paymentInitiated">
            <div *ngIf="isLoading">
              <h2>{{ 'payment.preparingPayment' | translate }}</h2>
              <p>{{ 'payment.redirectingToStripe' | translate }}</p>
              <div class="spinner"></div>
            </div>

            <div *ngIf="!isLoading && errorMessagePayment">
              <h2>{{ 'payment.errorInitiatingPayment' | translate }}</h2>
              <p>{{ errorMessagePayment }}</p>
              <button (click)="retryPayment()" class="btn btn-primary btn-lg btn-block " 
                [disabled]="isPendingApproval">{{ 'general.retryPayment' | translate }}</button>
              <button (click)="goToCategorySelection()" class="btn btn-secondary"
                [disabled]="isPendingApproval">{{ 'general.backToCategorySelection' |
                translate }}</button>
            </div>


          </div>
        </div>
      </div>

    </div>

    <div class="col-lg-3"></div>
  </div>
</div>